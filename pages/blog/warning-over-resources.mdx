import PostLayout from '@/components/layouts/post-layout'

export const meta = {
  author: 'Andhika',
  link: 'warning-over-resources',
  title: 'Warning Over Resources',
  slug: 'Peringatan penggunaan resource yang hampir mencapai limitnya.',
  isPublished: true,
  publishedOn: 'December 05, 2022',
  publishedDate: '2022/12/05',
  category: 'Vercel, Resources, BackEnd'
}

Currently Vercel is the most platfrom I like to publish my web apps.
Why? because I like to use NextJs and it's easy to deploy to production.
There so much tool I can use to improve my experience on development or deployment.

# Not a right way

My first time I use NextJs is for this website, my own website portfolio.
At that time I want to learn something new, 
I felt like I'm bored to code some modules of some platform and at that time I use programming language PHP.
It's doesn't mean I don't like PHP, 
at that time it's just like I don't know how to use PHP the right ways
and I don't know how powerful Laravel framework to build web application.

I didn't blame enyone why my application got over resources, 
otherwise I think because I develop application the wrong way.
For your information, after I got little experience how to use NextJs and Vercel.
I felt like I'm ready to develop custom application use NextJs and deploy to production use Vercel.

Coincidentally Company where my wife work need some application.
They want manufacturing application to improve operational in Company.
I think the management of Company already looking some vendor who already build application with same criteria as they need.
And my wife say, the price of application is too hight and management doesn't have budget that much.

At that time I didn't have any relationship with software house or solo developer who can handle to build her Company need.
And I think for one or two days to negotiate with my wife. 
So much obsession at that time, 
because it's something new to me and I really want to gain some new experience.
Luckily my proposal to my wife Company is accepted. 

On proposal I will develop application for 3 months, but in reality I develop application in 10 months.
There so much thing new to me, the biggest problem is "How to spare my time for double job".
Actually if you already married and already worked, you'll have 2 responsibility.
Responsibility to family and responsibility to company, but if you double job you'll add new responsibility.
I didn't say, "Side Hustle" is bad to us but it's just hard to maintain a time and energy.

# Process to develop

For your information, I use NextJs, Vercel, Supabase and SWR in this project.
In process development it's felt like some godlike tools, 
it's like very easy to develop application with just for CRUD function.

For using NextJs I can use bunch of library of reactJs. 
Vercel manage my application with transparent resource usage and easy deploy to staging / production environment.
Supabase with JS library for connecting database storage and file storage of application.
SWR for reactJs hook to data fetching and it magical, after data updated in other side data will be updated in my side with out reload the page.

Every process development working smoothly, of course because I can consult the detail function the Company needed with out I going to client office.
I doing this side project on 6 AM until 7 AM, after that I working for my office until 5 PM.
After working for my office, I continue to code on side project application from 6 PM until 10 PM or 11 PM. 
And mostly on weekend I still code for this side project, 
of course sometime in weekend I do not code on this side project, because I must spend my time with my family too.

At that time, I want to make complicated code to handle so much condition with fast response.
Because I think my wife Company will be not use data until **thousands or millions record**.
And I think library of Supabase will fetch all of data in table with fast response.
So I build application with much of logic in frontend, in backend I will just use library of Supabase.
And thankfully process hand over application finished in 10 months after project started.

# Guarantee of application

Because I use Supabase file storage for media in this application, and Supabase have limitation for free plan.
I worried with Supabase file storage space will be running out, and I cannot use free plan for supabase.
First month after hand over application to my wife Company application working well.
But what I was worried was different in reality, in supabase doesn't show any warning or alert.

In reality, Company use millions records of data.
And it make me realize, library of supabase limiting fetch data to 1000 records.
It's make me need to change how to fetch data from limited 1000 records to all records.
And what happen is, Vercel detected big execute time, bandwidth in API of NextJs.
And they send me email about "Usage Limit Warning".

<ImageBlur 
  alt="chris-curry" 
  src="/warning-vercel-over-resource.png" 
  width="500" 
  height="500" 
/>

<ImageBlur 
  alt="chris-curry" 
  src="/graph-resource.png" 
  width="500" 
  height="500" 
/>

<ImageBlur 
  alt="chris-curry" 
  src="/vercel-execute-time.png" 
  width="500" 
  height="500" 
/>

# Temporary solution

Honestly I don't have any budget for upgrading to Vercel paid membership.
So I move application from Vercel to VPS in Indonesia, I have VPS cheapest and luckily application can running in this VPS.
And I make announcement to the Company to move application to other domain, so they can access application to VPS.

Of course there some issue after moving application to server in Indonesia.
Application more slower, and sometime not accessible.
To solve the problem I decided to use CDN and problem application slow is solved.

# Permanent solution

My top priority is to refactoring fetch data because on current situation fetch data will return all records of data. 
I'll change fetch data to paging algorithm and searchable data.
I'll refactoring how to use SWR, it's look like I didn't use SWR and API the right way.
Because logic of paging and search I put to SWR only, I do not put to API.

I hope refactoring code will be working well. 
So I can share to anyone about this little experience next time.

export default ({ children }) => <PostLayout meta={meta}>{children}</PostLayout>